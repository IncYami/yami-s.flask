<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yami Studio | Index</title>
    <link rel="shortcut icon" href=static/favicon.png>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/offcanvas-navbar.css" rel="stylesheet">
    <link href="static/css/custom.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Card -->
    {% include 'index.Card.html' %}
    <!-- Navbar -->
    {% include 'index.Navbar.html' %}

    <!-- Grid view usando apenas classes nativas do Bootstrap 5 com as modificações solicitadas -->
    <div class="container mb-5">
        <!-- Centralizando todo o conteúdo -->
        <div class="row justify-content-center">
            <div class="col-12">
                <!-- Grid layout com espaçamento maior -->
                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4 justify-content-center">
                    {% for anime in anime_projects %}
                    <div class="col">
                        <!-- Card maior sem borda secundária -->
                        <div class="card h-100 bg-dark" onclick="openAnimeModal('{{ loop.index }}')" style="cursor: pointer;">
                            <!-- Container para imagem com data e ícones sobrepostos -->
                            <div class="position-relative">
                                <!-- Imagem de capa com altura maior -->
                                <img src="{{ anime.image_url }}" class="card-img-top" alt="{{ anime.name }}" style="height: 300px; object-fit: cover;">
                                
                                <!-- Data sobreposta na parte superior esquerda -->
                                <div class="position-absolute top-0 start-0 m-2">
                                    <span class="badge bg-dark bg-opacity-75 text-light">{{ anime.formatted_date }}</span>
                                </div>
                                
                                <!-- Badges como indicadores de status, na parte superior direita -->
                                <div class="position-absolute top-0 end-0 m-2 d-flex flex-wrap gap-1">
                                    {% if anime.last_update %}
                                    <span class="badge bg-warning text-dark animate-pulse"><i class="fas fa-sync-alt"></i></span>
                                    {% endif %}

                                    {% if anime.releasing %}
                                    <span class="badge bg-success animate-pulse"><i class="fas fa-film"></i></span>
                                    {% endif %}

                                    {% if anime.batch %}
                                    <span class="badge bg-primary"><i class="fas fa-box"></i></span>
                                    {% endif %}

                                    {% if anime.rev %}
                                    <span class="badge bg-danger animate-pulse"><i class="fas fa-edit"></i></span>
                                    {% endif %}

                                    {% if anime.planning %}
                                    <span class="badge bg-info"><i class="fas fa-clipboard-list"></i></span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Apenas o título na parte inferior -->
                            <div class="card-body py-3">
                                <!-- Título completo com possível quebra de linha -->
                                <h5 class="card-title mb-0 fs-6 fw-bold text-center" title="{{ anime.name }}">{{ anime.name }}</h5>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% if not anime_projects %}
                    <div class="col-12 text-center mt-5">
                        <h3>Nenhum projeto encontrado</h3>
                        <p>Adicione arquivos markdown na pasta 'markdowns' para começar.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modais fora do fluxo principal do documento para evitar problemas de layout -->
    {% for anime in anime_projects %}
    <div class="modal fade" id="animeModal-{{ loop.index }}" tabindex="-1" aria-labelledby="animeModalLabel-{{ loop.index }}" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title" id="animeModalLabel-{{ loop.index }}">
                        {{ anime.name }}
                        {% if anime.AniListID %}
                        <a href="https://anilist.co/anime/{{ anime.AniListID }}" target="_blank" class="ms-2 badge bg-primary text-decoration-none">
                            <i class="fas fa-arrow-up-right-from-square me-2"></i>AniList
                        </a>
                        {% endif %}
                        <!-- Share Button -->
                        <button onclick="shareAnime(event, '{{ loop.index }}', '{{ anime.name }}', '{{ anime.AniListID }}')" class="ms-2 badge bg-info border-0" title="Compartilhar">
                            <i class="fas fa-share-alt me-2"></i>Compartilhar
                        </button>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="anime-details-content">
                        <!-- Primeira linha: imagem e info -->
                        <div class="row mb-4">
                            <!-- Coluna da esquerda: Imagem e informações básicas -->
                            <div class="col-md-4 mb-4 mb-md-0">
                                <!-- Imagem de capa -->
                                <img src="{{ anime.image_url }}" class="img-fluid rounded mb-3" alt="{{ anime.name }}" style="width: 100%; object-fit: cover;">
                                
                                <!-- Informações básicas abaixo da imagem -->
                                <p class="mb-2">
                                    <i class="fas fa-calendar-alt me-2"></i> Data: {{ anime.formatted_date }}
                                </p>
                                
                                <!-- Status badges -->
                                <div class="d-flex flex-wrap gap-2 mb-3">
                                    {% if anime.last_update %}
                                    <span class="badge bg-warning text-dark animate-pulse">
                                        <i class="fas fa-sync-alt me-1"></i> Atualizado: {{ anime.formatted_update_date }}
                                    </span>
                                    {% endif %}
                                    {% if anime.releasing %}
                                    <span class="badge bg-success animate-pulse">
                                        <i class="fas fa-film me-1"></i> Em Lançamento
                                    </span>
                                    {% endif %}
                                    {% if anime.batch %}
                                    <span class="badge bg-primary">
                                        <i class="fas fa-box me-1"></i> Batch
                                    </span>
                                    {% endif %}
                                    {% if anime.rev %}
                                    <span class="badge bg-danger animate-pulse">
                                        <i class="fas fa-edit me-1"></i> Em Revisão
                                    </span>
                                    {% endif %}
                                    {% if anime.planning %}
                                    <span class="badge bg-info animate-pulse">
                                        <i class="fas fa-clipboard-list me-1"></i> Em Planejamento
                                    </span>
                                    {% endif %}
                                </div>
                                
                                <!-- Download buttons -->
                                <div class="d-grid gap-2">
                                    {% if anime.torrent %}
                                    <a href="{{ anime.torrent }}" class="btn btn-danger" target="_blank">
                                        <i class="fas fa-file-download me-1"></i> Download Torrent
                                    </a>
                                    {% endif %}
                                    
                                    {% if anime.magnet %}
                                    <a href="{{ anime.magnet }}" class="btn btn-warning" target="_blank">
                                        <i class="fas fa-magnet me-1"></i> Download Magnet
                                    </a>
                                    {% endif %}
                                    
                                    {% if anime.cloud %}
                                    <a href="{{ anime.cloud }}" class="btn btn-primary" target="_blank">
                                        <i class="fas fa-cloud-download-alt me-1"></i> Download Cloud
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Coluna da direita: Info e Changelog -->
                            <div class="col-md-8">
                                <!-- Seção de Info -->
                                {% include 'index.Info.html' %}
                                <!-- Seção de Changelog -->
                                {% include 'index.Changelog.html' %}
                                <!-- Seção de Arquivos -->
                                {% include 'index.Files.html' %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    
    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="static/js/search.js"></script>
    <script src="static/js/info.js"></script>
    <script src="static/js/share.js"></script>
    
    
    <script>
        // Array para armazenar referências aos modais
        const animeModals = {};
        
        // Função para abrir o modal de detalhes do anime
        function openAnimeModal(id) {
            const modalId = `animeModal-${id}`;
            
            // Se o modal ainda não foi inicializado, cria uma instância
            if (!animeModals[modalId]) {
                animeModals[modalId] = new bootstrap.Modal(document.getElementById(modalId));
            }
            
            // Abre o modal
            animeModals[modalId].show();
        }
    </script>
</body>
</html>